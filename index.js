const express =  require('express')
const app =  express()
const { stat, createReadStream } = require("fs");
const { promisify } = require("util");
const { pipeline } = require("stream");
const fileInfo = promisify(stat);

app.disable('etag')

app.get("/api/cache-control", async (req, res) => {
  res.set("Cache-Control", "max-age=3600")
  res.status(200).send([{"_id":"6164fd494d781a35cb8a5ec2","index":0,"guid":"0665d10a-9043-495e-be50-97b0a5b9505d","isActive":true,"balance":"$3,520.62","picture":"http://placehold.it/32x32","age":26,"eyeColor":"green","name":"Guy Roy","gender":"male","company":"QUAILCOM","email":"guyroy@quailcom.com","phone":"+1 (898) 512-3779","address":"657 Etna Street, Urbana, New York, 6188","about":"Deserunt laboris do esse sit ea est ex est ad eu sint deserunt nisi eiusmod. Sunt laboris ullamco laborum culpa mollit proident voluptate pariatur esse sunt qui quis do veniam. Duis non pariatur reprehenderit ipsum ipsum proident amet veniam reprehenderit officia cillum aliquip culpa. Veniam ea ipsum commodo id mollit enim dolore irure duis amet sunt veniam aliquip. Cillum incididunt do officia tempor labore.\r\n","registered":"2015-10-28T10:06:43 -07:00","latitude":-54.770804,"longitude":-17.284264,"tags":["sit","cillum","anim","sint","in","incididunt","ullamco"],"friends":[{"id":0,"name":"Leanna Pittman"},{"id":1,"name":"Dianne Vincent"},{"id":2,"name":"Henrietta Barrett"}],"greeting":"Hello, Guy Roy! You have 10 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd49ec1101e13c14a530","index":1,"guid":"b8536451-2de6-4044-ada4-46e600916f27","isActive":true,"balance":"$2,030.80","picture":"http://placehold.it/32x32","age":23,"eyeColor":"blue","name":"Leta Kennedy","gender":"female","company":"INSURITY","email":"letakennedy@insurity.com","phone":"+1 (825) 573-2846","address":"319 Lyme Avenue, Stollings, Rhode Island, 4368","about":"Velit do laborum eiusmod laborum tempor. Commodo labore sint veniam dolore qui sunt officia exercitation aliquip deserunt ad ut sunt. Est dolor tempor proident cillum ipsum enim exercitation minim eiusmod commodo aliqua officia nostrud. Aute nisi ut proident non ea mollit. Anim veniam sit elit non deserunt sint ut est ipsum quis et. Dolor minim fugiat Lorem incididunt culpa elit proident magna non nulla aliqua enim laborum. Cillum id exercitation dolore sit sunt sit reprehenderit tempor ullamco veniam.\r\n","registered":"2019-02-07T03:49:23 -07:00","latitude":18.370359,"longitude":-178.697167,"tags":["nostrud","sit","do","cillum","enim","eu","id"],"friends":[{"id":0,"name":"Jenkins Marshall"},{"id":1,"name":"Dominique Bruce"},{"id":2,"name":"Susanne Wiley"}],"greeting":"Hello, Leta Kennedy! You have 1 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd491e34fcda0589537c","index":2,"guid":"bd9f2043-a478-4938-bb6c-3eddec948386","isActive":false,"balance":"$2,400.38","picture":"http://placehold.it/32x32","age":20,"eyeColor":"brown","name":"Potter Vega","gender":"male","company":"VIASIA","email":"pottervega@viasia.com","phone":"+1 (831) 504-3200","address":"851 Dahlgreen Place, Haena, Virgin Islands, 7299","about":"Non reprehenderit culpa reprehenderit cillum amet ex anim. Culpa pariatur nulla sit non. Lorem magna aliquip nisi culpa cillum consectetur occaecat eiusmod sit officia non minim ad. Culpa veniam proident irure esse eu pariatur aliquip do officia magna elit adipisicing incididunt non.\r\n","registered":"2021-09-15T04:37:57 -07:00","latitude":9.322065,"longitude":-8.883046,"tags":["dolore","dolore","deserunt","aute","cupidatat","tempor","sint"],"friends":[{"id":0,"name":"Gilda Montgomery"},{"id":1,"name":"Noreen Tran"},{"id":2,"name":"Peters Sharp"}],"greeting":"Hello, Potter Vega! You have 4 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd497cdd462af01d1730","index":3,"guid":"4323433e-1e09-4074-86f5-f1161144b01d","isActive":false,"balance":"$2,247.78","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Myrna Martinez","gender":"female","company":"CORMORAN","email":"myrnamartinez@cormoran.com","phone":"+1 (961) 564-3320","address":"978 Exeter Street, Westerville, North Dakota, 1103","about":"In irure pariatur nisi commodo. Quis Lorem amet sit ex sit pariatur quis minim deserunt esse in laborum exercitation. Dolor cillum reprehenderit fugiat dolore ut ex aliqua elit adipisicing. Excepteur dolore sunt do consectetur amet nulla anim minim nisi tempor ullamco reprehenderit cupidatat mollit. Est cupidatat sunt occaecat adipisicing labore Lorem commodo aliquip duis consectetur excepteur et. Enim tempor aute nulla sint ipsum ex tempor enim.\r\n","registered":"2021-02-15T08:48:45 -07:00","latitude":-66.567911,"longitude":-170.881486,"tags":["eiusmod","excepteur","aliqua","Lorem","non","proident","sunt"],"friends":[{"id":0,"name":"Beth Le"},{"id":1,"name":"Cindy Zimmerman"},{"id":2,"name":"Shirley Kaufman"}],"greeting":"Hello, Myrna Martinez! You have 4 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd49e0f3c3b7b6d32a8f","index":4,"guid":"4b90bb55-3e34-4d3a-9fe7-54fbe0ff20e4","isActive":false,"balance":"$2,817.37","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Mollie Osborn","gender":"female","company":"OBLIQ","email":"mollieosborn@obliq.com","phone":"+1 (847) 516-2456","address":"777 Hubbard Street, Fruitdale, Arizona, 8884","about":"Sint culpa sint irure ad adipisicing exercitation irure cupidatat sit adipisicing adipisicing elit ad. Cupidatat culpa elit nostrud laborum laborum nisi sunt nulla et. Aliquip Lorem minim magna id eu voluptate do dolore qui nisi ea magna reprehenderit. Consequat officia nulla enim quis cillum veniam ea quis voluptate qui ex consequat. Qui quis dolore ea do nulla. Ea sint mollit fugiat minim occaecat eu pariatur esse irure voluptate ad. Ea adipisicing sint quis anim id pariatur.\r\n","registered":"2020-12-01T01:06:28 -07:00","latitude":67.237251,"longitude":-90.088234,"tags":["nostrud","do","ullamco","laborum","enim","incididunt","veniam"],"friends":[{"id":0,"name":"Alicia Huffman"},{"id":1,"name":"Ballard Cantrell"},{"id":2,"name":"Rae Ayers"}],"greeting":"Hello, Mollie Osborn! You have 4 unread messages.","favoriteFruit":"apple"},{"_id":"6164fd4949fb5d24da3b51f4","index":5,"guid":"e4d56042-b074-4b91-bfd6-c5290dec16e9","isActive":false,"balance":"$3,231.54","picture":"http://placehold.it/32x32","age":31,"eyeColor":"green","name":"Mccarthy Rich","gender":"male","company":"CENTICE","email":"mccarthyrich@centice.com","phone":"+1 (978) 437-3690","address":"999 Olive Street, Taft, Northern Mariana Islands, 371","about":"Et Lorem in est cupidatat culpa officia irure ullamco ea in cillum sint. Ex officia et incididunt deserunt. Labore et fugiat deserunt culpa veniam est qui deserunt cillum reprehenderit fugiat sit. Esse minim velit nulla aliqua anim. Ea irure exercitation proident fugiat labore cillum aliqua Lorem.\r\n","registered":"2019-05-12T07:08:41 -07:00","latitude":73.022256,"longitude":-96.69718,"tags":["commodo","nostrud","mollit","dolore","in","ullamco","reprehenderit"],"friends":[{"id":0,"name":"Therese Daugherty"},{"id":1,"name":"Murphy Sherman"},{"id":2,"name":"Blair Wilcox"}],"greeting":"Hello, Mccarthy Rich! You have 2 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd4920599f9d872ec0ba","index":6,"guid":"bcca60db-fa26-4cb5-a3a8-2cc7630bce8f","isActive":false,"balance":"$2,179.73","picture":"http://placehold.it/32x32","age":36,"eyeColor":"brown","name":"Bond Peters","gender":"male","company":"HARMONEY","email":"bondpeters@harmoney.com","phone":"+1 (806) 429-3581","address":"650 Vandalia Avenue, Brookfield, Virginia, 7216","about":"Eu laboris reprehenderit aute ad incididunt duis sit magna adipisicing officia ut. Dolor quis et laboris id. Duis id veniam incididunt minim tempor pariatur consequat qui esse occaecat nisi quis cupidatat. Labore excepteur mollit adipisicing elit culpa irure reprehenderit. Reprehenderit eiusmod sit tempor irure enim incididunt reprehenderit exercitation elit.\r\n","registered":"2015-03-21T06:40:44 -07:00","latitude":-41.736928,"longitude":90.607796,"tags":["mollit","in","aliqua","esse","quis","in","sit"],"friends":[{"id":0,"name":"Dorothy Bonner"},{"id":1,"name":"Kenya Fields"},{"id":2,"name":"Burt Leonard"}],"greeting":"Hello, Bond Peters! You have 10 unread messages.","favoriteFruit":"banana"}])
})

app.get("/api/with304", async (req, res) => {
  if (req.headers["if-none-match"] === "12345") {
    console.log("not modified serving")
    res.sendStatus(304);
    return
  }
  res.set("etag", "12345")
  // await delay(5000)
  res.status(200).send([{"_id":"6164fd494d781a35cb8a5ec2","index":0,"guid":"0665d10a-9043-495e-be50-97b0a5b9505d","isActive":true,"balance":"$3,520.62","picture":"http://placehold.it/32x32","age":26,"eyeColor":"green","name":"Guy Roy","gender":"male","company":"QUAILCOM","email":"guyroy@quailcom.com","phone":"+1 (898) 512-3779","address":"657 Etna Street, Urbana, New York, 6188","about":"Deserunt laboris do esse sit ea est ex est ad eu sint deserunt nisi eiusmod. Sunt laboris ullamco laborum culpa mollit proident voluptate pariatur esse sunt qui quis do veniam. Duis non pariatur reprehenderit ipsum ipsum proident amet veniam reprehenderit officia cillum aliquip culpa. Veniam ea ipsum commodo id mollit enim dolore irure duis amet sunt veniam aliquip. Cillum incididunt do officia tempor labore.\r\n","registered":"2015-10-28T10:06:43 -07:00","latitude":-54.770804,"longitude":-17.284264,"tags":["sit","cillum","anim","sint","in","incididunt","ullamco"],"friends":[{"id":0,"name":"Leanna Pittman"},{"id":1,"name":"Dianne Vincent"},{"id":2,"name":"Henrietta Barrett"}],"greeting":"Hello, Guy Roy! You have 10 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd49ec1101e13c14a530","index":1,"guid":"b8536451-2de6-4044-ada4-46e600916f27","isActive":true,"balance":"$2,030.80","picture":"http://placehold.it/32x32","age":23,"eyeColor":"blue","name":"Leta Kennedy","gender":"female","company":"INSURITY","email":"letakennedy@insurity.com","phone":"+1 (825) 573-2846","address":"319 Lyme Avenue, Stollings, Rhode Island, 4368","about":"Velit do laborum eiusmod laborum tempor. Commodo labore sint veniam dolore qui sunt officia exercitation aliquip deserunt ad ut sunt. Est dolor tempor proident cillum ipsum enim exercitation minim eiusmod commodo aliqua officia nostrud. Aute nisi ut proident non ea mollit. Anim veniam sit elit non deserunt sint ut est ipsum quis et. Dolor minim fugiat Lorem incididunt culpa elit proident magna non nulla aliqua enim laborum. Cillum id exercitation dolore sit sunt sit reprehenderit tempor ullamco veniam.\r\n","registered":"2019-02-07T03:49:23 -07:00","latitude":18.370359,"longitude":-178.697167,"tags":["nostrud","sit","do","cillum","enim","eu","id"],"friends":[{"id":0,"name":"Jenkins Marshall"},{"id":1,"name":"Dominique Bruce"},{"id":2,"name":"Susanne Wiley"}],"greeting":"Hello, Leta Kennedy! You have 1 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd491e34fcda0589537c","index":2,"guid":"bd9f2043-a478-4938-bb6c-3eddec948386","isActive":false,"balance":"$2,400.38","picture":"http://placehold.it/32x32","age":20,"eyeColor":"brown","name":"Potter Vega","gender":"male","company":"VIASIA","email":"pottervega@viasia.com","phone":"+1 (831) 504-3200","address":"851 Dahlgreen Place, Haena, Virgin Islands, 7299","about":"Non reprehenderit culpa reprehenderit cillum amet ex anim. Culpa pariatur nulla sit non. Lorem magna aliquip nisi culpa cillum consectetur occaecat eiusmod sit officia non minim ad. Culpa veniam proident irure esse eu pariatur aliquip do officia magna elit adipisicing incididunt non.\r\n","registered":"2021-09-15T04:37:57 -07:00","latitude":9.322065,"longitude":-8.883046,"tags":["dolore","dolore","deserunt","aute","cupidatat","tempor","sint"],"friends":[{"id":0,"name":"Gilda Montgomery"},{"id":1,"name":"Noreen Tran"},{"id":2,"name":"Peters Sharp"}],"greeting":"Hello, Potter Vega! You have 4 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd497cdd462af01d1730","index":3,"guid":"4323433e-1e09-4074-86f5-f1161144b01d","isActive":false,"balance":"$2,247.78","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Myrna Martinez","gender":"female","company":"CORMORAN","email":"myrnamartinez@cormoran.com","phone":"+1 (961) 564-3320","address":"978 Exeter Street, Westerville, North Dakota, 1103","about":"In irure pariatur nisi commodo. Quis Lorem amet sit ex sit pariatur quis minim deserunt esse in laborum exercitation. Dolor cillum reprehenderit fugiat dolore ut ex aliqua elit adipisicing. Excepteur dolore sunt do consectetur amet nulla anim minim nisi tempor ullamco reprehenderit cupidatat mollit. Est cupidatat sunt occaecat adipisicing labore Lorem commodo aliquip duis consectetur excepteur et. Enim tempor aute nulla sint ipsum ex tempor enim.\r\n","registered":"2021-02-15T08:48:45 -07:00","latitude":-66.567911,"longitude":-170.881486,"tags":["eiusmod","excepteur","aliqua","Lorem","non","proident","sunt"],"friends":[{"id":0,"name":"Beth Le"},{"id":1,"name":"Cindy Zimmerman"},{"id":2,"name":"Shirley Kaufman"}],"greeting":"Hello, Myrna Martinez! You have 4 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd49e0f3c3b7b6d32a8f","index":4,"guid":"4b90bb55-3e34-4d3a-9fe7-54fbe0ff20e4","isActive":false,"balance":"$2,817.37","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Mollie Osborn","gender":"female","company":"OBLIQ","email":"mollieosborn@obliq.com","phone":"+1 (847) 516-2456","address":"777 Hubbard Street, Fruitdale, Arizona, 8884","about":"Sint culpa sint irure ad adipisicing exercitation irure cupidatat sit adipisicing adipisicing elit ad. Cupidatat culpa elit nostrud laborum laborum nisi sunt nulla et. Aliquip Lorem minim magna id eu voluptate do dolore qui nisi ea magna reprehenderit. Consequat officia nulla enim quis cillum veniam ea quis voluptate qui ex consequat. Qui quis dolore ea do nulla. Ea sint mollit fugiat minim occaecat eu pariatur esse irure voluptate ad. Ea adipisicing sint quis anim id pariatur.\r\n","registered":"2020-12-01T01:06:28 -07:00","latitude":67.237251,"longitude":-90.088234,"tags":["nostrud","do","ullamco","laborum","enim","incididunt","veniam"],"friends":[{"id":0,"name":"Alicia Huffman"},{"id":1,"name":"Ballard Cantrell"},{"id":2,"name":"Rae Ayers"}],"greeting":"Hello, Mollie Osborn! You have 4 unread messages.","favoriteFruit":"apple"},{"_id":"6164fd4949fb5d24da3b51f4","index":5,"guid":"e4d56042-b074-4b91-bfd6-c5290dec16e9","isActive":false,"balance":"$3,231.54","picture":"http://placehold.it/32x32","age":31,"eyeColor":"green","name":"Mccarthy Rich","gender":"male","company":"CENTICE","email":"mccarthyrich@centice.com","phone":"+1 (978) 437-3690","address":"999 Olive Street, Taft, Northern Mariana Islands, 371","about":"Et Lorem in est cupidatat culpa officia irure ullamco ea in cillum sint. Ex officia et incididunt deserunt. Labore et fugiat deserunt culpa veniam est qui deserunt cillum reprehenderit fugiat sit. Esse minim velit nulla aliqua anim. Ea irure exercitation proident fugiat labore cillum aliqua Lorem.\r\n","registered":"2019-05-12T07:08:41 -07:00","latitude":73.022256,"longitude":-96.69718,"tags":["commodo","nostrud","mollit","dolore","in","ullamco","reprehenderit"],"friends":[{"id":0,"name":"Therese Daugherty"},{"id":1,"name":"Murphy Sherman"},{"id":2,"name":"Blair Wilcox"}],"greeting":"Hello, Mccarthy Rich! You have 2 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd4920599f9d872ec0ba","index":6,"guid":"bcca60db-fa26-4cb5-a3a8-2cc7630bce8f","isActive":false,"balance":"$2,179.73","picture":"http://placehold.it/32x32","age":36,"eyeColor":"brown","name":"Bond Peters","gender":"male","company":"HARMONEY","email":"bondpeters@harmoney.com","phone":"+1 (806) 429-3581","address":"650 Vandalia Avenue, Brookfield, Virginia, 7216","about":"Eu laboris reprehenderit aute ad incididunt duis sit magna adipisicing officia ut. Dolor quis et laboris id. Duis id veniam incididunt minim tempor pariatur consequat qui esse occaecat nisi quis cupidatat. Labore excepteur mollit adipisicing elit culpa irure reprehenderit. Reprehenderit eiusmod sit tempor irure enim incididunt reprehenderit exercitation elit.\r\n","registered":"2015-03-21T06:40:44 -07:00","latitude":-41.736928,"longitude":90.607796,"tags":["mollit","in","aliqua","esse","quis","in","sit"],"friends":[{"id":0,"name":"Dorothy Bonner"},{"id":1,"name":"Kenya Fields"},{"id":2,"name":"Burt Leonard"}],"greeting":"Hello, Bond Peters! You have 10 unread messages.","favoriteFruit":"banana"}])
})

app.get("/api/without304", (req, res) => {
  res.status(200).send([{"_id":"6164fd494d781a35cb8a5ec2","index":0,"guid":"0665d10a-9043-495e-be50-97b0a5b9505d","isActive":true,"balance":"$3,520.62","picture":"http://placehold.it/32x32","age":26,"eyeColor":"green","name":"Guy Roy","gender":"male","company":"QUAILCOM","email":"guyroy@quailcom.com","phone":"+1 (898) 512-3779","address":"657 Etna Street, Urbana, New York, 6188","about":"Deserunt laboris do esse sit ea est ex est ad eu sint deserunt nisi eiusmod. Sunt laboris ullamco laborum culpa mollit proident voluptate pariatur esse sunt qui quis do veniam. Duis non pariatur reprehenderit ipsum ipsum proident amet veniam reprehenderit officia cillum aliquip culpa. Veniam ea ipsum commodo id mollit enim dolore irure duis amet sunt veniam aliquip. Cillum incididunt do officia tempor labore.\r\n","registered":"2015-10-28T10:06:43 -07:00","latitude":-54.770804,"longitude":-17.284264,"tags":["sit","cillum","anim","sint","in","incididunt","ullamco"],"friends":[{"id":0,"name":"Leanna Pittman"},{"id":1,"name":"Dianne Vincent"},{"id":2,"name":"Henrietta Barrett"}],"greeting":"Hello, Guy Roy! You have 10 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd49ec1101e13c14a530","index":1,"guid":"b8536451-2de6-4044-ada4-46e600916f27","isActive":true,"balance":"$2,030.80","picture":"http://placehold.it/32x32","age":23,"eyeColor":"blue","name":"Leta Kennedy","gender":"female","company":"INSURITY","email":"letakennedy@insurity.com","phone":"+1 (825) 573-2846","address":"319 Lyme Avenue, Stollings, Rhode Island, 4368","about":"Velit do laborum eiusmod laborum tempor. Commodo labore sint veniam dolore qui sunt officia exercitation aliquip deserunt ad ut sunt. Est dolor tempor proident cillum ipsum enim exercitation minim eiusmod commodo aliqua officia nostrud. Aute nisi ut proident non ea mollit. Anim veniam sit elit non deserunt sint ut est ipsum quis et. Dolor minim fugiat Lorem incididunt culpa elit proident magna non nulla aliqua enim laborum. Cillum id exercitation dolore sit sunt sit reprehenderit tempor ullamco veniam.\r\n","registered":"2019-02-07T03:49:23 -07:00","latitude":18.370359,"longitude":-178.697167,"tags":["nostrud","sit","do","cillum","enim","eu","id"],"friends":[{"id":0,"name":"Jenkins Marshall"},{"id":1,"name":"Dominique Bruce"},{"id":2,"name":"Susanne Wiley"}],"greeting":"Hello, Leta Kennedy! You have 1 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd491e34fcda0589537c","index":2,"guid":"bd9f2043-a478-4938-bb6c-3eddec948386","isActive":false,"balance":"$2,400.38","picture":"http://placehold.it/32x32","age":20,"eyeColor":"brown","name":"Potter Vega","gender":"male","company":"VIASIA","email":"pottervega@viasia.com","phone":"+1 (831) 504-3200","address":"851 Dahlgreen Place, Haena, Virgin Islands, 7299","about":"Non reprehenderit culpa reprehenderit cillum amet ex anim. Culpa pariatur nulla sit non. Lorem magna aliquip nisi culpa cillum consectetur occaecat eiusmod sit officia non minim ad. Culpa veniam proident irure esse eu pariatur aliquip do officia magna elit adipisicing incididunt non.\r\n","registered":"2021-09-15T04:37:57 -07:00","latitude":9.322065,"longitude":-8.883046,"tags":["dolore","dolore","deserunt","aute","cupidatat","tempor","sint"],"friends":[{"id":0,"name":"Gilda Montgomery"},{"id":1,"name":"Noreen Tran"},{"id":2,"name":"Peters Sharp"}],"greeting":"Hello, Potter Vega! You have 4 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd497cdd462af01d1730","index":3,"guid":"4323433e-1e09-4074-86f5-f1161144b01d","isActive":false,"balance":"$2,247.78","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Myrna Martinez","gender":"female","company":"CORMORAN","email":"myrnamartinez@cormoran.com","phone":"+1 (961) 564-3320","address":"978 Exeter Street, Westerville, North Dakota, 1103","about":"In irure pariatur nisi commodo. Quis Lorem amet sit ex sit pariatur quis minim deserunt esse in laborum exercitation. Dolor cillum reprehenderit fugiat dolore ut ex aliqua elit adipisicing. Excepteur dolore sunt do consectetur amet nulla anim minim nisi tempor ullamco reprehenderit cupidatat mollit. Est cupidatat sunt occaecat adipisicing labore Lorem commodo aliquip duis consectetur excepteur et. Enim tempor aute nulla sint ipsum ex tempor enim.\r\n","registered":"2021-02-15T08:48:45 -07:00","latitude":-66.567911,"longitude":-170.881486,"tags":["eiusmod","excepteur","aliqua","Lorem","non","proident","sunt"],"friends":[{"id":0,"name":"Beth Le"},{"id":1,"name":"Cindy Zimmerman"},{"id":2,"name":"Shirley Kaufman"}],"greeting":"Hello, Myrna Martinez! You have 4 unread messages.","favoriteFruit":"strawberry"},{"_id":"6164fd49e0f3c3b7b6d32a8f","index":4,"guid":"4b90bb55-3e34-4d3a-9fe7-54fbe0ff20e4","isActive":false,"balance":"$2,817.37","picture":"http://placehold.it/32x32","age":35,"eyeColor":"blue","name":"Mollie Osborn","gender":"female","company":"OBLIQ","email":"mollieosborn@obliq.com","phone":"+1 (847) 516-2456","address":"777 Hubbard Street, Fruitdale, Arizona, 8884","about":"Sint culpa sint irure ad adipisicing exercitation irure cupidatat sit adipisicing adipisicing elit ad. Cupidatat culpa elit nostrud laborum laborum nisi sunt nulla et. Aliquip Lorem minim magna id eu voluptate do dolore qui nisi ea magna reprehenderit. Consequat officia nulla enim quis cillum veniam ea quis voluptate qui ex consequat. Qui quis dolore ea do nulla. Ea sint mollit fugiat minim occaecat eu pariatur esse irure voluptate ad. Ea adipisicing sint quis anim id pariatur.\r\n","registered":"2020-12-01T01:06:28 -07:00","latitude":67.237251,"longitude":-90.088234,"tags":["nostrud","do","ullamco","laborum","enim","incididunt","veniam"],"friends":[{"id":0,"name":"Alicia Huffman"},{"id":1,"name":"Ballard Cantrell"},{"id":2,"name":"Rae Ayers"}],"greeting":"Hello, Mollie Osborn! You have 4 unread messages.","favoriteFruit":"apple"},{"_id":"6164fd4949fb5d24da3b51f4","index":5,"guid":"e4d56042-b074-4b91-bfd6-c5290dec16e9","isActive":false,"balance":"$3,231.54","picture":"http://placehold.it/32x32","age":31,"eyeColor":"green","name":"Mccarthy Rich","gender":"male","company":"CENTICE","email":"mccarthyrich@centice.com","phone":"+1 (978) 437-3690","address":"999 Olive Street, Taft, Northern Mariana Islands, 371","about":"Et Lorem in est cupidatat culpa officia irure ullamco ea in cillum sint. Ex officia et incididunt deserunt. Labore et fugiat deserunt culpa veniam est qui deserunt cillum reprehenderit fugiat sit. Esse minim velit nulla aliqua anim. Ea irure exercitation proident fugiat labore cillum aliqua Lorem.\r\n","registered":"2019-05-12T07:08:41 -07:00","latitude":73.022256,"longitude":-96.69718,"tags":["commodo","nostrud","mollit","dolore","in","ullamco","reprehenderit"],"friends":[{"id":0,"name":"Therese Daugherty"},{"id":1,"name":"Murphy Sherman"},{"id":2,"name":"Blair Wilcox"}],"greeting":"Hello, Mccarthy Rich! You have 2 unread messages.","favoriteFruit":"banana"},{"_id":"6164fd4920599f9d872ec0ba","index":6,"guid":"bcca60db-fa26-4cb5-a3a8-2cc7630bce8f","isActive":false,"balance":"$2,179.73","picture":"http://placehold.it/32x32","age":36,"eyeColor":"brown","name":"Bond Peters","gender":"male","company":"HARMONEY","email":"bondpeters@harmoney.com","phone":"+1 (806) 429-3581","address":"650 Vandalia Avenue, Brookfield, Virginia, 7216","about":"Eu laboris reprehenderit aute ad incididunt duis sit magna adipisicing officia ut. Dolor quis et laboris id. Duis id veniam incididunt minim tempor pariatur consequat qui esse occaecat nisi quis cupidatat. Labore excepteur mollit adipisicing elit culpa irure reprehenderit. Reprehenderit eiusmod sit tempor irure enim incididunt reprehenderit exercitation elit.\r\n","registered":"2015-03-21T06:40:44 -07:00","latitude":-41.736928,"longitude":90.607796,"tags":["mollit","in","aliqua","esse","quis","in","sit"],"friends":[{"id":0,"name":"Dorothy Bonner"},{"id":1,"name":"Kenya Fields"},{"id":2,"name":"Burt Leonard"}],"greeting":"Hello, Bond Peters! You have 10 unread messages.","favoriteFruit":"banana"}])
})

app.get('/api/downloadWithRangeCache', async function(req, res){
  const file = `${__dirname}/test.json`;

  /** Calculate Size of file */
  const { size } = await fileInfo(file);
  const range = req.headers.range;

  res.set("Accept-Ranges", "bytes")
  res.set("etag", "12345")
  // res.set("etag", "W/12345")

  /** Check for Range header */
  if (range) {
    /** Extracting Start and End value from Range Header */
    let [start, end] = range.replace(/bytes=/, "").split("-");
    start = parseInt(start, 10);
    end = end ? parseInt(end, 10) : size - 1;

    const hasStart = !isNaN(start)
    const hasEnd = !isNaN(end)
    if (hasStart && !hasEnd) {
      end = size - 1;
    }
    if (!hasStart && hasEnd) {
      start = size - end;
      end = size - 1;
    }

    // Handle unavailable range request
    if (start >= size || end >= size) {
      // Return the 416 Range Not Satisfiable.
      res.writeHead(416, {
        "Content-Range": `bytes */${size}`
      });
      return res.end();
    }

    /** Sending Partial Content With HTTP Code 206 */
    res.writeHead(206, {
      "Content-Range": `bytes ${start}-${end}/${size}`,
      "Accept-Ranges": "bytes",
      "Content-Length": end - start + 1,
      "Content-Type": "application/json"
    });

    let readable = createReadStream(file, { start: start, end: end });
    pipeline(readable, res, err => {
      console.log(err);
    });

  } else {

    res.writeHead(200, {
      "Content-Length": size,
      "Content-Type": "application/json"
    });

    let readable = createReadStream(file);
    pipeline(readable, res, err => {
      console.log(err);
    });

  }
});

app.get("/", express.static("."))

app.listen(8000);


async function delay(ms) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      resolve()
    }, ms)
  })

}